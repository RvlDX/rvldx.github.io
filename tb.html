<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tebak Kata Jepang Multi-API</title>
    <style>
        :root {
            --primary: #2ecc71;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui;
        }

        body {
            background: var(--light);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 1rem;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            padding: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .status-box {
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            background: var(--dark);
            color: white;
            font-weight: 500;
        }

        .word-display {
            font-size: 2.5rem;
            text-align: center;
            margin: 2rem 0;
            color: var(--dark);
            min-height: 60px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .option {
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .correct {
            background: var(--primary) !important;
            border-color: var(--primary);
            color: white;
        }

        .wrong {
            background: var(--danger) !important;
            border-color: var(--danger);
            color: white;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--dark);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="status-box">Skor: <span id="score">0</span></div>
            <div class="status-box">Nyawa: <span id="lives">3</span></div>
            <div class="status-box">API: <span id="apiStatus">Loading...</span></div>
        </div>

        <div class="word-display" id="wordDisplay"></div>
        
        <div class="options-grid" id="optionsGrid"></div>
        
        <div id="loader" class="loader" style="display: none;"></div>
    </div>

    <script>
        // Konfigurasi API
        const API_CONFIG = {
            jisho: {
                url: 'https://jisho.org/api/v1/search/words?keyword=%23common',
                parser: data => data.data.map(entry => ({
                    word: entry.japanese[0]?.reading,
                    meaning: entry.senses[0]?.english_definitions[0]
                }))
            },
            oxford: {
                url: 'https://od-api.oxforddictionaries.com/api/v2/translations/en/ja/',
                headers: {
                    'app_id': 'YOUR_OXFORD_APP_ID',
                    'app_key': 'YOUR_OXFORD_APP_KEY'
                },
                parser: data => data.results.map(result => ({
                    word: result.word,
                    meaning: result.translations[0].text
                }))
            },
            google: {
                translate: async (text) => {
                    const response = await fetch(
                        `https://translation.googleapis.com/language/translate/v2?key=YOUR_GOOGLE_API_KEY&q=${text}&source=ja&target=en`
                    );
                    const data = await response.json();
                    return data.data.translations[0].translatedText;
                }
            }
        };

        const FALLBACK_WORDS = [/*...*/];

        let gameState = {
            score: 0,
            lives: 3,
            currentWord: null,
            apiUsed: null
        };

        async function fetchData() {
            showLoader();
            
            try {
                // Coba Jisho API dulu
                const jishoData = await tryJishoAPI();
                if(jishoData) return jishoData;
                
                // Jika gagal, coba Oxford API
                const oxfordData = await tryOxfordAPI();
                if(oxfordData) return oxfordData;
                
                // Jika semua gagal, gunakan fallback
                useFallback();
            } catch (error) {
                console.error('Error fetching data:', error);
                useFallback();
            }
        }

        async function tryJishoAPI() {
            try {
                const response = await fetch(API_CONFIG.jisho.url);
                const data = await response.json();
                const parsed = API_CONFIG.jisho.parser(data)
                    .filter(item => item.word && item.meaning);
                
                if(parsed.length > 5) {
                    updateApiStatus('Jisho API');
                    return parsed;
                }
            } catch (error) {
                return null;
            }
        }

        async function tryOxfordAPI() {
            try {
                const response = await fetch(API_CONFIG.oxford.url, {
                    headers: API_CONFIG.oxford.headers
                });
                const data = await response.json();
                const parsed = API_CONFIG.oxford.parser(data);
                
                if(parsed.length > 5) {
                    updateApiStatus('Oxford API');
                    return parsed;
                }
            } catch (error) {
                return null;
            }
        }

        function useFallback() {
            updateApiStatus('Local Data');
            return FALLBACK_WORDS;
        }

        async function initGame() {
            const words = await fetchData();
            setupGame(words);
        }

        function setupGame(words) {
            const randomIndex = Math.floor(Math.random() * words.length);
            gameState.currentWord = words[randomIndex];
            
            displayWord();
            generateOptions(words);
            hideLoader();
        }

        function generateOptions(words) {
            const options = [gameState.currentWord.meaning];
            
            // Ambil 3 jawaban salah acak
            while(options.length < 4) {
                const randomWord = words[Math.floor(Math.random() * words.length)];
                if(randomWord.meaning !== gameState.currentWord.meaning) {
                    options.push(randomWord.meaning);
                }
            }

            // Acak urutan
            options.sort(() => Math.random() - 0.5);

            // Render options
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = options
                .map(opt => `
                    <button class="option" onclick="checkAnswer('${opt}')">
                        ${opt}
                    </button>
                `).join('');
        }

        async function checkAnswer(selected) {
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.disabled = true);
            
            // Validasi menggunakan Google Translate API
            const isCorrect = await validateWithGoogle(selected);

            if(isCorrect) {
                handleCorrectAnswer();
            } else {
                handleWrongAnswer();
            }

            updateGameState();
            showNextQuestion();
        }

        async function validateWithGoogle(selected) {
            try {
                const translated = await API_CONFIG.google.translate(gameState.currentWord.word);
                return translated.toLowerCase() === selected.toLowerCase();
            } catch {
                return selected === gameState.currentWord.meaning;
            }
        }

        function handleCorrectAnswer() {
            gameState.score += 10;
            document.getElementById('score').textContent = gameState.score;
        }

        function handleWrongAnswer() {
            gameState.lives--;
            document.getElementById('lives').textContent = gameState.lives;
        }

        function updateGameState() {
            if(gameState.lives <= 0) {
                endGame();
            }
        }

        function showNextQuestion() {
            setTimeout(() => {
                initGame();
            }, 2000);
        }

        function endGame() {
            alert(`Game Over! Skor akhir: ${gameState.score}`);
            location.reload();
        }

        // Helper functions
        function displayWord() {
            document.getElementById('wordDisplay').textContent = gameState.currentWord.word;
        }

        function updateApiStatus(apiName) {
            document.getElementById('apiStatus').textContent = apiName;
        }

        function showLoader() {
            document.getElementById('loader').style.display = 'block';
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }

        // Initialize game
        initGame();
    </script>
</body>
</html>